@using DataProtection.PageModels.lab2
@using DataProtection.Engine.Managers

<h3>Шифр Эль-Гамаля</h3>


<div class="row pb-4">
    <button class="btn btn-nav" @onclick="@Encrypt">Зашифровать</button>
</div>

<div class="row pb-4">
    <button class="btn btn-nav" @onclick="@Decode">Дешифровать</button>
</div>


<div>
    <button class="btn btn-nav" @onclick="@generate">Генерация</button>
</div>

<div>
    <div>p = @ElGamal.p</div>
    <div>q = @ElGamal.q</div>
    <div>g = @ElGamal.g</div>
    <div>Ca = @ElGamal.Ca</div>
    <div>Da = @ElGamal.Da</div>

</div>

@code {

    ElGamalModel ElGamal = new ElGamalModel();

    IsPrime prime = new IsPrime();

    public void Encrypt()
    {
        Random random = new Random();

    }

    public void Decode()
    {

    }

    public void generate()
    {
        Random random = new Random();
        MyModPow modPow = new MyModPow();

        long currentQ, currentP;
        do {
            do {
                currentQ = random.Next(1 << 7, 1 << 8);
            } while (!prime.isPrime(currentQ, 1 << 10));
            ElGamal.q = currentQ;
            currentP = ElGamal.q * 2 + 1;

        } while (!prime.isPrime(currentP, 1 << 10));

        ElGamal.p = currentP;

        for (int i = 2; i < ElGamal.p - 1; i++) {
            if (modPow.Pow(i, ElGamal.q, ElGamal.p) != 1) {
                ElGamal.g = i;
                break;
            }
        }

        ElGamal.Ca = random.Next(2, (int)ElGamal.p);

        ElGamal.Da = modPow.Pow(ElGamal.g, ElGamal.Ca, ElGamal.p);
    }
}
